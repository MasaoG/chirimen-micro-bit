<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>GPIO-1 Analog-out sample</title>
</head>

<script type="text/javascript" src="../polyfill/microBitBLE.js"></script>

<script>
var microBitBle;

var gpioPort2;
var connected;

async function connect(){
	microBitBle = await microBitBleFactory.connect();
	msg.innerHTML=("micro:bit BLE接続しました。");
	connected = true;
	// GPIO
	var gpioAccess = await microBitBle.requestGPIOAccess();
	var mbGpioPorts = gpioAccess.ports;
	gpioPort2 = mbGpioPorts.get(2);
	await gpioPort2.export("analogin"); //port2 analogin : pull none
	measure();
}

async function disconnect(){
	connected = false;
	await microBitBle.disconnect();
	msg.innerHTML=("micro:bit BLE接続を切断しました。");
}



async function measure(){
	while( connected ){
		var g2Val = await gpioPort2.read();
		gdata2.innerHTML=g2Val;
		await sleep(100);
	}
}

</script>    

<body>
<form name="js">
<input type="button" value="Connect" onclick="connect();"/> 
<input type="button" value="Disconnect" onclick="disconnect();" /> 
</form>
<hr>

<table>
	<tr><td>msg1:</td><td id="msg">-</td></tr>
	<tr><td id="gdata2">NULL</td></tr>
</table>

<img src="../imgs/CMMB_GPIO_EXT_example1.png" width="400"/>

</body>
</html>